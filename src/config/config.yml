audio:
  send_sample_rate: 16000
  receive_sample_rate: 24000
  channels: 1
  chunk_size_vad: 256
  chunk_size_default: 1024
# 1-3 when 3 is the most agressive ( sensitive to noise )
vad:
  enabled: true
  barge_in_enabled: false 
  backend: "silero"

  # Silero Specifics
  silero_model_path: "src/audio/models/silero_vad.onnx"
  silero_sample_rate: 8000
  silero_frame_ms: 32
  # Silero VAD Thresholds (Lower = more sensitive)
  silero_threshold: 0.3  # Lowered from 0.5 to catch short words like "כן"
  silero_echo_threshold: 0.3  # Lowered from 0.75 for better detection during echo guard
  silero_min_speech_ms: 160  # Lowered from 64ms to catch very short utterances

  # ONNX Performance
  onnx_intra_op_threads: 1
  onnx_inter_op_threads: 1

  # SNR (Signal-to-Noise Ratio)
  snr_factor: 1.5  # Lowered from 2.5 for more sensitive detection
  noise_floor_window_ms: 1500
  update_noise_floor_in_echo_guard: false
  freeze_noise_floor_while_speaking: true

  # Legacy / Flow
  echo_guard_ms: 150
  echo_guard_extra_frames: 0  # Instant during bot speech (was 2)
  barge_in_cooldown_ms: 400
  end_silence_ms: 700  # Increased from 300ms - allows longer pauses between sentences without ending speech
  
  # Base params (kept for reference or fallback logic)
  sample_rate: 8000
  frame_ms: 32 # Unified to match Silero requirement

# Turn-based state management
turn:
  # User silence detection (dual-gate: VAD + RMS) - 2 level escalation
  user_silence_warning_interval_s: 8  # Time between each warning (8s, 16s)
  
  # Escalation messages
  silence_message_1: "סליחה לא שמעתי מה אמרתה"
  silence_message_final: "עדיין אין מענה, אסיים את השיחה כעת"
  
  # RMS-based voice detection with burst accumulation (prevents false triggers)
  user_silence_snr_high: 1.5      # SNR to enter voice mode (harder threshold)
  user_silence_snr_low: 1.25        # SNR to stay in voice mode (easier, hysteresis)
  rms_absolute_minimum: 250        # Minimum RMS to consider as voice
  rms_bootstrap_multiplier: 1.3      # Conservative multiplier when noise floor uninitialized
  user_silence_confirm_ms: 160       # ms of voice activity needed to reset timer
  user_silence_decay_halflife_ms: 200  # Half-life for time-aware exponential decay
  
  # Safety mechanisms
  startup_grace_period_s: 2.0        # Don't trigger warnings in first 2s of call
  check_playout_before_warning: true # Don't interrupt bot speech with warnings

gemini:
  model_id: "gemini-2.5-flash-native-audio-preview-12-2025"
  use_defaults: true
  voice_name: "Aoede"
  temperature: 0.4
  greeting_text: "שלום שמי שיר, מהמרפאה של אורי מאיר. כיצד אוכל לסייע ?"

watchdog:
  silence_timeout_ms: 6000  # 6 seconds - realistic timeout for dead air during Gemini turn
  max_nudges_per_turn: 2    # Limit nudges to avoid spam
  silence_nudge_text: "המשיכי לענות עכשיו בקול"  # Continue in voice

twilio:
  account_sid: "${TWILIO_ACCOUNT_SID}"
  auth_token: "${TWILIO_AUTH_TOKEN}"
  phone_number: "${TWILIO_PHONE_NUMBER}"
  public_url: "${PUBLIC_URL}"

