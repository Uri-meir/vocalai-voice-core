audio:
  send_sample_rate: 16000
  receive_sample_rate: 24000
  channels: 1
  chunk_size_vad: 256
  chunk_size_default: 1024
# 1-3 when 3 is the most agressive ( sensitive to noise )
vad:
  enabled: false
  barge_in_enabled: false 
  backend: "silero"

  # Silero Specifics
  silero_model_path: "src/audio/models/silero_vad.onnx"
  silero_sample_rate: 8000
  silero_frame_ms: 32
  # Silero VAD Thresholds (Lower = more sensitive)
  silero_threshold: 0.25  # Further lowered to catch short words like "yes", "no", "okay"
  silero_echo_threshold: 0.3  # Lowered from 0.75 for better detection during echo guard
  silero_min_speech_ms: 100  # Reduced from 160ms - short answers can be 200-300ms total

  # ONNX Performance
  onnx_intra_op_threads: 1
  onnx_inter_op_threads: 1

  # SNR (Signal-to-Noise Ratio)
  snr_factor: 1.5  # Lowered from 2.5 for more sensitive detection
  noise_floor_window_ms: 1500
  update_noise_floor_in_echo_guard: false
  freeze_noise_floor_while_speaking: true

  # Legacy / Flow
  echo_guard_ms: 150
  echo_guard_extra_frames: 0  # Instant during bot speech (was 2)
  end_silence_ms: 700  # Increased from 300ms - allows longer pauses between sentences without ending speech
  
  # Barge-in (turn-aware interruption)
  barge_in_vad_only: false  # false = use dual-gate (VAD + RMS), true = VAD only
  barge_in_rms_burst_ms: 100  # Reduced from 140ms - allow shorter interruptions
  barge_in_cooldown_ms: 600  # Global cooldown - prevent multiple interrupts (VAD + RMS)
  barge_in_respect_echo_guard: true  # Disable during echo guard window
  barge_in_grace_period_ms: 250  # Don't allow interrupting first 200ms of playout
  barge_in_tail_ignore_ms: 400  # Ignore speaker audio for 300ms after barge-in (prevents leakage)
  
  # Base params (kept for reference or fallback logic)
  sample_rate: 8000
  frame_ms: 32 # Unified to match Silero requirement

# Turn-based state management
turn:
  # User silence detection (dual-gate: VAD + RMS) - 2 level escalation
  user_silence_warning_interval_s: 9  # Time between each warning (8s, 16s)
  
  # Escalation messages
  silence_message_1: "סליחה לא שמעתי מה אמרתה"
  silence_message_final: "עדיין אין מענה, אסיים את השיחה כעת"
  
  # RMS-based voice detection with burst accumulation (prevents false triggers)
  user_silence_snr_high: 1.35     # Lowered from 1.5 - more sensitive to soft-spoken short answers
  user_silence_snr_low: 1.15      # Lowered from 1.25 - easier to maintain voice mode
  rms_absolute_minimum: 200       # Lowered from 250 - catch quieter responses
  rms_bootstrap_multiplier: 1.3   # Conservative multiplier when noise floor uninitialized
  user_silence_confirm_ms: 100    # Reduced from 160ms - short "yes"/"no" are ~200-300ms
  user_silence_decay_halflife_ms: 200  # Half-life for time-aware exponential decay
  
  # Safety mechanisms
  startup_grace_period_s: 2.0        # Don't trigger warnings in first 2s of call
  check_playout_before_warning: true # Don't interrupt bot speech with warnings

gemini:
  model_id: "gemini-2.5-flash-native-audio-preview-12-2025"
  use_defaults: true
  voice_name: "Aoede"
  temperature: 0.4
  greeting_text: "שלום שמי שיר, מהמרפאה של אורי מאיר. כיצד אוכל לסייע ?"
  enable_transcription: true  # Enable audio transcription for call logging

openai:
  # NOTE: Some accounts do NOT have access to the gpt-4o-realtime-preview* models.
  # This default is chosen because it is widely available; if you have access to a newer model,
  # override via DB `voice_assistant_configs.llm_model`.
  model_id: "gpt-realtime-2025-08-28"  # OpenAI Realtime model (default)
  fallback_model_id: "gpt-realtime-2025-08-28"  # Used if the requested model is not accessible
  voice_name: "nova"  # OpenAI voice (alloy, echo, shimmer, fable, onyx, nova)
  temperature: 0.8
  debug_events: false  # If true, logs all Realtime events (VERY noisy; keep false in prod)
  input_sample_rate_hz: 16000   # Matches mic_queue PCM format
  output_sample_rate_hz: 24000  # Matches Twilio sender expectation
  enable_transcription: true    # Enable audio transcription for call logging
  language_instruction: "You MUST respond ONLY in Hebrew. Never switch to English or any other language, regardless of names or context."

watchdog:
  silence_timeout_ms: 7000  # 6 seconds - realistic timeout for dead air during Gemini turn
  max_nudges_per_turn: 2    # Limit nudges to avoid spam
  silence_nudge_text: "המשיכי לענות עכשיו בקול"  # Continue in voice

twilio:
  account_sid: "${TWILIO_ACCOUNT_SID}"
  auth_token: "${TWILIO_AUTH_TOKEN}"
  phone_number: "${TWILIO_PHONE_NUMBER}"
  public_url: "${PUBLIC_URL}"


# Soniox STT (Dual Channel)
soniox:
  enabled: true  # Enable parallel STT stream
  model: "stt-rt-preview"
  language_hints: ["he", "en"]
  enable_endpoint_detection: true
  fallback_timeout_ms: 3000  # Wait for Gemini before injecting Soniox transcript
  max_utterance_length: 50  # Only fallback for very short utterances (char count)
  max_word_count: 10  # Maximum words for fallback (e.g., "כן", "לא", "מחר")
  freshness_window_ms: 7000  # Must be > fallback_timeout_ms
  cooldown_ms: 800  # Prevent multiple fallbacks in quick succession
